# Story 4.6: Recommendation Dashboard UI Components

## Status
Draft

## Story

**As a** dynasty fantasy player,
**I want** a comprehensive recommendation dashboard with specialized UI components,
**so that** I can easily understand my team needs, explore recommendations, and make informed roster decisions.

## Acceptance Criteria

1. Team needs visualization component showing positional gaps and depth analysis
2. Enhanced recommendation card component with detailed fit scoring breakdown
3. Trade targets list component for buy-low and sell-high opportunities
4. Draft strategy board component for rookie draft guidance
5. Stash candidates component for roster spot optimization
6. Risk tolerance settings component for personalization preferences
7. Recommendation filters component for customizing recommendations
8. All components integrate with Story 4.4 backend API endpoints
9. Mobile-responsive design following UX architecture specifications
10. Comprehensive component tests with React Testing Library

## Tasks / Subtasks

- [ ] Task 1: Create TeamNeedsOverview Component (AC: 1, 8, 9)
  - [ ] Build TeamNeedsOverview component integrating with `/api/recommendations/team-needs/{league_id}`
  - [ ] Implement positional gap visualization with severity indicators
  - [ ] Add competitive window display (contending/transitional/rebuilding)
  - [ ] Create depth chart gap visual representation
  - [ ] Add responsive design for mobile/tablet/desktop
  - [ ] Write component tests with React Testing Library

- [ ] Task 2: Build Enhanced RecommendationCard Component (AC: 2, 8, 9)
  - [ ] Create RecommendationCard component with detailed fit score breakdown
  - [ ] Implement position fit, timeline fit, and value rating display
  - [ ] Add explanation and confidence level visualization
  - [ ] Create interactive expand/collapse for detailed metrics
  - [ ] Add mobile-responsive card layout
  - [ ] Write component tests for all interaction states

- [ ] Task 3: Implement TradeTargetsList Component (AC: 3, 8, 9)
  - [ ] Build TradeTargetsList integrating with `/api/recommendations/trade-targets/{league_id}`
  - [ ] Create buy-low candidates section with undervalued indicators
  - [ ] Add sell-high opportunities section with overperformance indicators
  - [ ] Implement value arbitrage display with team-context explanations
  - [ ] Add category filtering (buy_low, sell_high, arbitrage)
  - [ ] Write comprehensive component tests

- [ ] Task 4: Create DraftStrategyBoard Component (AC: 4, 8, 9)
  - [ ] Build DraftStrategyBoard integrating with `/api/recommendations/draft-strategy/{league_id}`
  - [ ] Implement tiered draft board display (Tier 1, Tier 2, Tier 3)
  - [ ] Add BPA vs Need recommendation visualization
  - [ ] Create sleeper candidates section for late rounds
  - [ ] Add pick number input for contextual recommendations
  - [ ] Write component tests for tier display and filtering

- [ ] Task 5: Implement StashCandidates Component (AC: 5, 8, 9)
  - [ ] Build StashCandidates integrating with `/api/recommendations/stash-candidates/{league_id}`
  - [ ] Display available roster spots indicator
  - [ ] Create stash candidate list with upside scores and ETAs
  - [ ] Add timeline-appropriate filtering (rebuild-focused)
  - [ ] Implement opportunity cost calculator display
  - [ ] Write component tests for roster spot logic

- [ ] Task 6: Build RiskToleranceSettings Component (AC: 6, 8, 9)
  - [ ] Create RiskToleranceSettings integrating with `/api/recommendations/preferences`
  - [ ] Implement risk tolerance selector (conservative/balanced/aggressive)
  - [ ] Add timeline preference toggles (win-now vs rebuild)
  - [ ] Create position priorities multi-select
  - [ ] Add trade preference toggles (buy-low/sell-high)
  - [ ] Implement save/update functionality with API integration
  - [ ] Write component tests for preference updates

- [ ] Task 7: Create RecommendationFilters Component (AC: 7, 8, 9)
  - [ ] Build RecommendationFilters with query parameter management
  - [ ] Implement risk tolerance filter dropdown
  - [ ] Add position filter multi-select
  - [ ] Create ETA year range slider
  - [ ] Add trade value filter checkboxes
  - [ ] Implement filter reset functionality
  - [ ] Write component tests for filter state management

- [ ] Task 8: Create useRecommendations Custom Hook (AC: 8)
  - [ ] Build useRecommendations hook wrapping all recommendation API calls
  - [ ] Implement team needs fetching with caching
  - [ ] Add prospect recommendations with pagination
  - [ ] Create trade targets fetching with category filtering
  - [ ] Add draft strategy fetching with pick context
  - [ ] Implement stash candidates fetching
  - [ ] Add user preferences GET/PUT operations
  - [ ] Write hook tests with mock API responses

- [ ] Task 9: Add Recommendation Type Definitions (AC: 8)
  - [ ] Create recommendations.ts types file
  - [ ] Define TeamNeeds interface matching API response
  - [ ] Add RecommendationDetails interface with fit breakdown
  - [ ] Create TradeTarget interface for trade opportunities
  - [ ] Define DraftStrategy interface for draft recommendations
  - [ ] Add StashCandidate interface
  - [ ] Create UserPreferences interface

- [ ] Task 10: Build API Client Extensions (AC: 8)
  - [ ] Create recommendations.ts API client file
  - [ ] Implement getTeamNeeds API function
  - [ ] Add getProspectRecommendations with query params
  - [ ] Create getTradeTargets with category filtering
  - [ ] Implement getDraftStrategy with pick number
  - [ ] Add getStashCandidates API function
  - [ ] Create getUserPreferences and updateUserPreferences functions
  - [ ] Write API client tests with mock responses

## Dev Notes

### Previous Story Context
[Source: Story 4.4 Dev Agent Record]
- All backend API endpoints implemented and tested in Story 4.4
- Endpoints include premium tier authorization and rate limiting (60 req/hour)
- Response schemas defined in `apps/api/app/schemas/recommendations.py`
- Redis caching: 30-min for recommendations, 1-hour for team needs
- Existing PersonalizedRecommendations.tsx component provides basic recommendation display
- useFantrax hook provides league selection and basic recommendation loading

### Tech Stack
[Source: technical-architecture/1-system-overview.md#core-services]
- **Frontend**: Next.js 14 with React 18 and TypeScript
- **UI Components**: shadcn/ui component library
- **State Management**: React hooks with custom data-fetching hooks
- **Styling**: Tailwind CSS with responsive utilities
- **Testing**: Jest with React Testing Library
- **Icons**: lucide-react icon library

### Component Architecture
[Source: technical-architecture/coding-standards.md#react-nextjs-standards]

**Component Structure Pattern:**
```typescript
/**
 * Component description
 *
 * @component ComponentName
 * @param {Props} props - Component props
 * @returns {JSX.Element} Rendered component
 *
 * @example
 * ```tsx
 * <ComponentName prop1="value" />
 * ```
 */
export const ComponentName: React.FC<Props> = ({ prop1, prop2 }) => {
  // Component implementation
};
```

**Required Documentation:**
- JSDoc comments for all components with @component tag
- Props interface with descriptions
- @example tag showing usage
- @since version tag

### API Integration Specifications

**Team Needs Endpoint:**
[Source: Story 4.4 Dev Notes - API Specifications]
```typescript
GET /api/recommendations/team-needs/{league_id}
Response: {
  positional_needs: [{ position: string, severity: string, timeline: string }],
  depth_analysis: { [position: string]: { starters: number, depth: number, gap_score: number }},
  competitive_window: "contending" | "transitional" | "rebuilding",
  future_needs: { "2_year": [...], "3_year": [...] }
}
```

**Prospect Recommendations Endpoint:**
```typescript
GET /api/recommendations/prospects/{league_id}?limit=20&risk_tolerance=balanced
Response: {
  recommendations: [{
    prospect_id: number,
    fit_score: number,
    position_fit: number,
    timeline_fit: number,
    value_rating: string,
    explanation: string,
    confidence: "high" | "medium" | "low"
  }]
}
```

**Trade Targets Endpoint:**
```typescript
GET /api/recommendations/trade-targets/{league_id}?category=buy_low
Response: {
  buy_low_candidates: [...],
  sell_high_opportunities: [...],
  trade_value_arbitrage: [...]
}
```

**Draft Strategy Endpoint:**
```typescript
GET /api/recommendations/draft-strategy/{league_id}?pick_number=5
Response: {
  tier_1: [{ prospect_id, draft_value, need_match }],
  tier_2: [...],
  bpa_vs_need: string,
  sleepers: [...]
}
```

**Stash Candidates Endpoint:**
```typescript
GET /api/recommendations/stash-candidates/{league_id}
Response: {
  available_spots: number,
  stash_candidates: [{ prospect_id, upside_score, eta, reasoning }]
}
```

**User Preferences Endpoints:**
```typescript
GET /api/recommendations/preferences
PUT /api/recommendations/preferences
Request/Response: {
  risk_tolerance: "conservative" | "balanced" | "aggressive",
  prefer_win_now: boolean,
  prefer_rebuild: boolean,
  position_priorities: string[],
  prefer_buy_low: boolean,
  prefer_sell_high: boolean
}
```

### File Locations

**Component Files:**
[Source: Existing project structure]
- `apps/web/src/components/recommendations/TeamNeedsOverview.tsx` (new)
- `apps/web/src/components/recommendations/RecommendationCard.tsx` (new)
- `apps/web/src/components/recommendations/TradeTargetsList.tsx` (new)
- `apps/web/src/components/recommendations/DraftStrategyBoard.tsx` (new)
- `apps/web/src/components/recommendations/StashCandidates.tsx` (new)
- `apps/web/src/components/recommendations/RiskToleranceSettings.tsx` (new)
- `apps/web/src/components/recommendations/RecommendationFilters.tsx` (new)
- `apps/web/src/components/recommendations/PersonalizedRecommendations.tsx` (existing - reference for patterns)

**Hook Files:**
- `apps/web/src/hooks/useRecommendations.ts` (new)
- `apps/web/src/hooks/useFantrax.ts` (existing - reference for patterns)

**Type Files:**
- `apps/web/src/types/recommendations.ts` (new)
- `apps/web/src/types/fantrax.ts` (existing - reference for patterns)

**API Client Files:**
- `apps/web/src/lib/api/recommendations.ts` (new)
- `apps/web/src/lib/api/fantrax.ts` (existing - reference for patterns)

**Test Files:**
- `apps/web/src/__tests__/recommendations/TeamNeedsOverview.test.tsx` (new)
- `apps/web/src/__tests__/recommendations/RecommendationCard.test.tsx` (new)
- `apps/web/src/__tests__/recommendations/TradeTargetsList.test.tsx` (new)
- `apps/web/src/__tests__/recommendations/DraftStrategyBoard.test.tsx` (new)
- `apps/web/src/__tests__/recommendations/StashCandidates.test.tsx` (new)
- `apps/web/src/__tests__/recommendations/RiskToleranceSettings.test.tsx` (new)
- `apps/web/src/__tests__/recommendations/RecommendationFilters.test.tsx` (new)
- `apps/web/src/__tests__/hooks/useRecommendations.test.ts` (new)

### UX Design Specifications

**Mobile-Responsive Design:**
[Source: ux-architecture/3-wireframe-specifications.md]
- **Desktop (1440px+)**: Side-by-side layouts with full details
- **Tablet (768-1024px)**: Stacked layouts with collapsible sections
- **Mobile (320-767px)**: Card-based layouts with bottom sheet filters

**Component Patterns:**
- Card-based layouts using shadcn/ui Card component
- Badge components for severity, confidence, value indicators
- Collapsible sections for detailed breakdowns
- Loading states with Loader2 spinner from lucide-react
- Error states with Alert component from shadcn/ui
- Empty states with descriptive messaging and call-to-action

**Color Coding Standards:**
[Source: ux-architecture/wireframe-specifications.md]
- **High Confidence/Fit**: Green (bg-green-50, text-green-600)
- **Medium Confidence/Fit**: Blue (bg-blue-50, text-blue-600)
- **Low Confidence/Fit**: Yellow (bg-yellow-50, text-yellow-600)
- **Warning/Risk**: Orange (bg-orange-50, text-orange-600)
- **Error/Critical**: Red (bg-red-50, text-red-600)

### State Management Strategy

**Component State Pattern:**
```typescript
// Use existing useFantrax pattern as reference
const {
  data,
  loading,
  error,
  refetch
} = useRecommendations();
```

**Loading States:**
- Display Loader2 spinner with descriptive text
- Disable interactive elements during loading
- Show skeleton loaders for content (optional enhancement)

**Error Handling:**
- Display user-friendly error messages in Alert components
- Provide retry functionality with refetch
- Handle 403 (premium tier) errors with upgrade prompt
- Handle 429 (rate limit) errors with retry guidance

**Empty States:**
- Show descriptive messaging when no data available
- Provide actionable next steps (e.g., "Sync roster", "Select league")
- Use appropriate icons from lucide-react

### Integration Points

**Existing Components:**
[Source: apps/web/src/components/recommendations/PersonalizedRecommendations.tsx]
- PersonalizedRecommendations component shows basic pattern for:
  - useFantrax hook integration
  - Loading/error/empty state handling
  - Card-based layout with badges
  - Mobile-responsive grid layouts
  - Color-coded fit scores

**Existing Hooks:**
[Source: apps/web/src/hooks/useFantrax.ts - inferred from usage]
- useFantrax provides: selectedLeague, loading states, error handling
- Pattern for data fetching with React hooks
- State management for API responses

**shadcn/ui Components Available:**
- Card, CardHeader, CardTitle, CardDescription, CardContent
- Button (variants: default, outline, destructive)
- Badge (variants: default, outline, destructive)
- Alert, AlertDescription
- Select, SelectContent, SelectItem, SelectTrigger, SelectValue
- Slider for range inputs
- Checkbox for multi-select

### Authentication & Authorization

**Premium Tier Requirements:**
[Source: Story 4.4 Security Considerations]
- All recommendation endpoints require premium tier authorization
- Display upgrade prompt for 403 Forbidden responses
- Show premium badge or indicator on components
- Handle JWT token expiration gracefully

**Rate Limiting:**
[Source: Story 4.4 QA Results]
- 60 requests/hour limit on recommendation endpoints
- Display rate limit error with retry guidance
- Implement client-side request throttling (optional enhancement)

### Performance Considerations

**Response Time Targets:**
[Source: Story 4.4 Performance Requirements]
- Team needs analysis: <2 seconds
- Prospect recommendations: <3 seconds
- Trade targets: <4 seconds
- Draft strategy: <3 seconds

**Caching Strategy:**
[Source: Story 4.4 Caching Strategy]
- Backend caching handles most optimization
- Client-side: Cache responses in hook state
- Refetch on user action (refresh button, filter change)
- Respect backend TTLs (30-min recommendations, 1-hour team needs)

## Testing

### Testing Standards
[Source: technical-architecture/coding-standards.md#testing-standards]

**Test File Locations:**
- Component tests: `apps/web/src/__tests__/recommendations/*.test.tsx`
- Hook tests: `apps/web/src/__tests__/hooks/*.test.ts`
- API client tests: `apps/web/src/__tests__/api/*.test.ts`

**Testing Requirements:**
- All components require tests with React Testing Library
- Test rendering, user interactions, loading states, error states
- Mock API responses using MSW (Mock Service Worker)
- Test mobile-responsive behavior (viewport changes)
- Verify accessibility (ARIA labels, keyboard navigation)
- Test premium tier authorization flows
- Validate error handling and retry logic

**Test Frameworks:**
- Jest for test runner
- React Testing Library for component testing
- MSW for API mocking
- @testing-library/user-event for user interactions

**Test Coverage Requirements:**
- Minimum 85% code coverage for components
- 100% coverage for critical user flows (recommendation loading, preferences)
- Edge cases: Empty states, error states, loading states
- Accessibility tests: Screen reader compatibility, keyboard navigation

**Example Test Structure:**
```typescript
/**
 * @jest-environment jsdom
 */
describe('TeamNeedsOverview Component', () => {
  it('should display team needs when data is loaded', async () => {
    // Test implementation
  });

  it('should show loading state while fetching', () => {
    // Test implementation
  });

  it('should handle error state gracefully', () => {
    // Test implementation
  });

  it('should be mobile responsive', () => {
    // Test implementation
  });
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-03 | 1.0 | Initial story creation for Story 4.4 frontend components | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_
